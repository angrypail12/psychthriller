<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychological Thriller Outline</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 100%;
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #d4902b;
            margin-bottom: 20px;
            background-color: #fdf2d4;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #d4902b;
        }
        
        .editable-title {
            border: none;
            background: transparent;
            font-size: 24px;
            font-weight: bold;
            color: #d4902b;
            text-align: center;
            width: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            vertical-align: top;
            position: relative;
            min-width: 120px;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: center;
        }
        
        .scene-cell {
            background-color: #e8f5e8;
            font-weight: bold;
            width: 150px;
        }
        
        .act1 { background-color: #d4f4dd; }
        .act2 { background-color: #fff2cc; }
        .act3 { background-color: #f4cccc; }
        
        .percentage {
            font-size: 10px;
            color: #666;
        }
        
        .text-item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 4px;
            margin: 2px 0;
            cursor: text;
            min-height: 20px;
            font-size: 11px;
        }
        
        .text-item:hover {
            background-color: #f0f0f0;
        }
        
        .text-item:focus {
            outline: 2px solid #4CAF50;
            background-color: white;
        }
        
        .add-item-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            margin-top: 2px;
        }
        
        .add-item-btn:hover {
            background-color: #45a049;
        }
        
        .delete-item-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 1px 4px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 9px;
            float: right;
            margin-left: 4px;
        }
        
        .delete-item-btn:hover {
            background-color: #cc0000;
        }
        
        .count-cell {
            background-color: #e0e0e0;
            font-weight: bold;
            text-align: center;
        }
        
        .controls {
            margin: 10px 0;
            text-align: center;
        }
        
        .control-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 14px;
        }
        
        .control-btn:hover {
            background-color: #1976D2;
        }
        
        .column-header {
            position: relative;
        }
        
        .header-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .column-header:hover .header-controls {
            opacity: 1;
        }
        
        .header-btn {
            background-color: #666;
            color: white;
            border: none;
            padding: 1px 4px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 9px;
            margin-left: 2px;
        }
        
        .header-btn:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">
            <input type="text" class="editable-title" value="Book Title" placeholder="Enter your book title">
        </div>
        
        <div class="controls">
            <button class="control-btn" onclick="addColumn()">Add Column</button>
            <button class="control-btn" onclick="addRow()">Add Scene</button>
            <button class="control-btn" onclick="saveData()">Save Progress</button>
            <button class="control-btn" onclick="loadData()">Load Progress</button>
        </div>
        
        <table id="outlineTable">
            <thead>
                <tr>
                    <th class="column-header">
                        Scenes
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Large Clues - Obvious (6-8)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Large Clues - Subtle (10-12)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Major Red Herrings/Misdirection (2-3) - on top of eight clues
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Minor Misdirection (8-10) - combined with clues
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Major Twist/Revelation (2-3 MAX)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Other minor/minor Revelations (8-12) (7 max)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Major Contradictions/Inconsistencies from Unreliable Narr (5-8)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Minor inconsistencies from Unreliable Narr (10-15)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- Act I Scenes -->
                <tr class="act1">
                    <td class="scene-cell">Scene 1 (Opening Image) - 5%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <tr class="act1">
                    <td class="scene-cell">Scene 2 (Inciting Incident) - 14%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2">
                        <div class="text-item" contenteditable="true">A clue to establish mystery</div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7">
                        <div class="text-item" contenteditable="true">We learn that the narrator has a strange father that he questions but the dad didn't help</div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <tr class="act1">
                    <td class="scene-cell">Scene 3 (Lock-in) - 24%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2">
                        <div class="text-item" contenteditable="true">2-3 clues to build complexity</div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5">
                        <div class="text-item" contenteditable="true">We learn the father doesn't actually have cancer</div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <!-- Act II Scenes -->
                <tr class="act2">
                    <td class="scene-cell">Scene 4 (Opening First Encounters) - 40%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <tr class="act2">
                    <td class="scene-cell">Scene 5 (Midpoint Revelation) - 57%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <tr class="act2">
                    <td class="scene-cell">Scene 6 (Things Get Worse) - 74%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <!-- Act III Scenes -->
                <tr class="act3">
                    <td class="scene-cell">Scene 7 (Final Confrontation) - 85%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <tr class="act3">
                    <td class="scene-cell">Scene 8 (Resolution of the Sin) - 93%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5">
                        <div class="text-item" contenteditable="true">A clue in final pieces</div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7">
                        <div class="text-item" contenteditable="true">We learn the daughter decided to believe it okay that her father's past crisis, because she is an the brainwashing her father</div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
                <tr class="act3">
                    <td class="scene-cell">Scene 9 (New Equilibrium) - 100%</td>
                    <td class="data-cell" data-column="1"></td>
                    <td class="data-cell" data-column="2"></td>
                    <td class="data-cell" data-column="3"></td>
                    <td class="data-cell" data-column="4"></td>
                    <td class="data-cell" data-column="5"></td>
                    <td class="data-cell" data-column="6"></td>
                    <td class="data-cell" data-column="7"></td>
                    <td class="data-cell" data-column="8"></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td class="count-cell">Count</td>
                    <td class="count-cell" id="count-1">0</td>
                    <td class="count-cell" id="count-2">0</td>
                    <td class="count-cell" id="count-3">0</td>
                    <td class="count-cell" id="count-4">0</td>
                    <td class="count-cell" id="count-5">0</td>
                    <td class="count-cell" id="count-6">0</td>
                    <td class="count-cell" id="count-7">0</td>
                    <td class="count-cell" id="count-8">0</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>
        // Initialize the table and add necessary event listeners
        document.addEventListener('DOMContentLoaded', function() {
            updateAllCounts();
            addTextItemsToEmptyCells();
        });

        function addTextItemsToEmptyCells() {
            const dataCells = document.querySelectorAll('.data-cell');
            dataCells.forEach(cell => {
                if (!cell.querySelector('.text-item') && !cell.querySelector('.add-item-btn')) {
                    const addBtn = document.createElement('button');
                    addBtn.className = 'add-item-btn';
                    addBtn.textContent = '+';
                    addBtn.onclick = function() { addTextItem(this); };
                    cell.appendChild(addBtn);
                }
            });
        }

        function addTextItem(button) {
            const cell = button.parentNode;
            const textItem = document.createElement('div');
            textItem.className = 'text-item';
            textItem.contentEditable = true;
            textItem.placeholder = 'Enter text...';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-item-btn';
            deleteBtn.textContent = '×';
            deleteBtn.onclick = function() { 
                textItem.remove(); 
                updateColumnCount(cell.dataset.column);
            };
            
            textItem.appendChild(deleteBtn);
            
            // Add event listener for content changes
            textItem.addEventListener('input', function() {
                updateColumnCount(cell.dataset.column);
            });
            
            // Insert before the add button
            cell.insertBefore(textItem, button);
            textItem.focus();
            
            updateColumnCount(cell.dataset.column);
        }

        function updateColumnCount(columnIndex) {
            if (!columnIndex) return;
            
            let count = 0;
            const cells = document.querySelectorAll(`[data-column="${columnIndex}"]`);
            
            cells.forEach(cell => {
                const textItems = cell.querySelectorAll('.text-item');
                textItems.forEach(item => {
                    if (item.textContent.trim() !== '' && item.textContent.trim() !== '×') {
                        count++;
                    }
                });
            });
            
            const countCell = document.getElementById(`count-${columnIndex}`);
            if (countCell) {
                countCell.textContent = count;
            }
        }

        function updateAllCounts() {
            for (let i = 1; i <= 8; i++) {
                updateColumnCount(i);
            }
        }

        function addColumn() {
            const table = document.getElementById('outlineTable');
            const headerRow = table.querySelector('thead tr');
            const bodyRows = table.querySelectorAll('tbody tr');
            const footerRow = table.querySelector('tfoot tr');
            
            const columnIndex = headerRow.children.length;
            
            // Add header
            const newHeader = document.createElement('th');
            newHeader.className = 'column-header';
            newHeader.innerHTML = `
                New Column
                <div class="header-controls">
                    <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                    <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                </div>
            `;
            headerRow.appendChild(newHeader);
            
            // Add cells to body rows
            bodyRows.forEach(row => {
                const newCell = document.createElement('td');
                newCell.className = 'data-cell';
                newCell.dataset.column = columnIndex - 1;
                
                const addBtn = document.createElement('button');
                addBtn.className = 'add-item-btn';
                addBtn.textContent = '+';
                addBtn.onclick = function() { addTextItem(this); };
                newCell.appendChild(addBtn);
                
                row.appendChild(newCell);
            });
            
            // Add footer count cell
            const newCountCell = document.createElement('td');
            newCountCell.className = 'count-cell';
            newCountCell.id = `count-${columnIndex - 1}`;
            newCountCell.textContent = '0';
            footerRow.appendChild(newCountCell);
        }

        function addRow() {
            const table = document.getElementById('outlineTable');
            const tbody = table.querySelector('tbody');
            const headerCount = table.querySelector('thead tr').children.length;
            
            const newRow = document.createElement('tr');
            newRow.className = 'act2'; // Default to Act II styling
            
            // Scene cell
            const sceneCell = document.createElement('td');
            sceneCell.className = 'scene-cell';
            sceneCell.contentEditable = true;
            sceneCell.textContent = `New Scene - 0%`;
            newRow.appendChild(sceneCell);
            
            // Data cells
            for (let i = 1; i < headerCount; i++) {
                const dataCell = document.createElement('td');
                dataCell.className = 'data-cell';
                dataCell.dataset.column = i;
                
                const addBtn = document.createElement('button');
                addBtn.className = 'add-item-btn';
                addBtn.textContent = '+';
                addBtn.onclick = function() { addTextItem(this); };
                dataCell.appendChild(addBtn);
                
                newRow.appendChild(dataCell);
            }
            
            tbody.appendChild(newRow);
        }

        function deleteColumn(button) {
            if (!confirm('Are you sure you want to delete this column?')) return;
            
            const header = button.closest('th');
            const columnIndex = Array.from(header.parentNode.children).indexOf(header);
            
            if (columnIndex === 0) {
                alert('Cannot delete the scenes column');
                return;
            }
            
            // Remove header
            header.remove();
            
            // Remove cells from all rows
            const table = document.getElementById('outlineTable');
            const rows = table.querySelectorAll('tbody tr, tfoot tr');
            rows.forEach(row => {
                if (row.children[columnIndex]) {
                    row.children[columnIndex].remove();
                }
            });
            
            // Update column indices
            updateColumnIndices();
        }

        function updateColumnIndices() {
            const table = document.getElementById('outlineTable');
            const bodyRows = table.querySelectorAll('tbody tr');
            
            bodyRows.forEach(row => {
                const dataCells = row.querySelectorAll('.data-cell');
                dataCells.forEach((cell, index) => {
                    cell.dataset.column = index + 1;
                });
            });
            
            // Update count cell IDs
            const countCells = table.querySelectorAll('tfoot .count-cell');
            countCells.forEach((cell, index) => {
                if (index > 0) {
                    cell.id = `count-${index}`;
                }
            });
            
            updateAllCounts();
        }

        function editColumnHeader(button) {
            const header = button.closest('th');
            const currentText = header.firstChild.textContent.trim();
            const newText = prompt('Enter new column header:', currentText);
            
            if (newText !== null && newText.trim() !== '') {
                header.innerHTML = `
                    ${newText}
                    <div class="header-controls">
                        <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                        <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                    </div>
                `;
            }
        }

        function saveData() {
            const data = {
                title: document.querySelector('.editable-title').value,
                table: document.getElementById('outlineTable').outerHTML
            };
            
            localStorage.setItem('thrillerOutline', JSON.stringify(data));
            alert('Progress saved!');
        }

        function loadData() {
            const saved = localStorage.getItem('thrillerOutline');
            if (saved) {
                const data = JSON.parse(saved);
                document.querySelector('.editable-title').value = data.title;
                document.getElementById('outlineTable').outerHTML = data.table;
                
                // Re-attach event listeners
                setTimeout(() => {
                    updateAllCounts();
                    addTextItemsToEmptyCells();
                }, 100);
                
                alert('Progress loaded!');
            } else {
                alert('No saved progress found!');
            }
        }
    </script>
</body>
</html>
