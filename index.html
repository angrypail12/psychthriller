<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychological Thriller Outline</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 100%;
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #d4902b;
            margin-bottom: 20px;
            background-color: #fdf2d4;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #d4902b;
        }
        
        .editable-title {
            border: none;
            background: transparent;
            font-size: 24px;
            font-weight: bold;
            color: #d4902b;
            text-align: center;
            width: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            vertical-align: top;
            position: relative;
            min-width: 120px;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: center;
        }
        
        .scene-cell {
            background-color: #e8f5e8;
            font-weight: bold;
            width: 150px;
            position: relative;
        }
        
        .scene-cell:hover .scene-delete-btn {
            opacity: 1;
        }
        
        .scene-delete-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 2px 5px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 10px;
            position: absolute;
            top: 2px;
            right: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .scene-delete-btn:hover {
            background-color: #cc0000;
        }
        
        .act1 { background-color: #d4f4dd; }
        .act2 { background-color: #fff2cc; }
        .act3 { background-color: #f4cccc; }
        
        .percentage {
            font-size: 10px;
            color: #666;
        }
        
        .text-item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 6px 6px 25px 6px;
            margin: 3px 0;
            cursor: text;
            min-height: 25px;
            font-size: 13px;
            position: relative;
        }
        
        .item-content {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .item-controls {
            position: absolute;
            bottom: 2px;
            left: 4px;
            right: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 9px;
        }
        
        .item-type-select {
            font-size: 9px;
            padding: 1px 3px;
            border: 1px solid #ccc;
            border-radius: 2px;
            background-color: white;
            max-width: 120px;
        }
        
        .type-major-revelation { border-left: 4px solid #ff4444; }
        .type-minor-revelation { border-left: 4px solid #ff9999; }
        .type-large-clue-obvious { border-left: 4px solid #4444ff; }
        .type-large-clue-subtle { border-left: 4px solid #9999ff; }
        .type-major-red-herring { border-left: 4px solid #ff8800; }
        .type-minor-misdirection { border-left: 4px solid #ffaa44; }
        .type-major-contradiction { border-left: 4px solid #8800ff; }
        .type-minor-inconsistency { border-left: 4px solid #bb88ff; }
        .type-false-suspect { border-left: 4px solid #ff8800; }
.type-misleading-motivation { border-left: 4px solid #ff6600; }
.type-wrong-interpretation { border-left: 4px solid #ff4400; }
.type-misleading-dialogue { border-left: 4px solid #ffaa44; }
.type-coincidence { border-left: 4px solid #ffcc66; }
.type-character-behavior { border-left: 4px solid #ff9944; }
.type-major-revelation { border-left: 4px solid #ff4444; }
.type-character-backstory { border-left: 4px solid #ff9999; }
.type-relationship-truth { border-left: 4px solid #ffaaaa; }
.type-small-mystery { border-left: 4px solid #ff7777; }
.type-memory-error { border-left: 4px solid #8800ff; }
.type-relationship-lie { border-left: 4px solid #9933ff; }
.type-misperception { border-left: 4px solid #aa44ff; }
.type-timeline-error { border-left: 4px solid #bb88ff; }
.type-emotional-contradiction { border-left: 4px solid #ccaaff; }
.type-detail-inconsistency { border-left: 4px solid #dd99ff; }
        
        .text-item:hover {
            background-color: #f0f0f0;
        }
        
        .text-item:focus {
            outline: 2px solid #4CAF50;
            background-color: white;
        }
        
        .add-item-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            margin-top: 2px;
        }
        
        .add-item-btn:hover {
            background-color: #45a049;
        }
        
        .delete-item-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 1px 4px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 9px;
        }
        
        .delete-item-btn:hover {
            background-color: #cc0000;
        }
        
        .count-cell {
            background-color: #e0e0e0;
            font-weight: bold;
            text-align: center;
        }
        
        .controls {
            margin: 10px 0;
            text-align: center;
        }
        
        .control-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 14px;
        }
        
        .control-btn:hover {
            background-color: #1976D2;
        }
        
        .control-btn.danger {
            background-color: #f44336;
        }
        
        .control-btn.danger:hover {
            background-color: #d32f2f;
        }
        
        .column-header {
            position: relative;
        }
        
        .header-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .column-header:hover .header-controls {
            opacity: 1;
        }
        
        .header-btn {
            background-color: #666;
            color: white;
            border: none;
            padding: 1px 4px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 9px;
            margin-left: 2px;
        }
        
        .header-btn:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">
            <input type="text" class="editable-title" value="Book Title" placeholder="Enter your book title">
        </div>
        
        <div class="controls">
            <button class="control-btn" onclick="addColumn()">Add Column</button>
            <button class="control-btn" onclick="addRow()">Add Scene</button>
            <button class="control-btn danger" onclick="deleteSelectedRow()">Delete Scene</button>
            <button class="control-btn" onclick="saveData()">Save Progress</button>
            <button class="control-btn" onclick="loadData()">Load Progress</button>
            <button class="control-btn" onclick="exportData()">Export Data</button>
            <button class="control-btn" onclick="importData()">Import Data</button>
        </div>
        
        <table id="outlineTable">
            <thead>
                <tr>
                    <th class="column-header">
                        Scenes
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Large Clues - Obvious (6-8)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Large Clues - Subtle (10-12)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Major Red Herrings/Misdirection (2-3) - on top of eight clues
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Minor Misdirection (8-10) - combined with clues
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Major Twist/Revelation (2-3 MAX)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Other minor/minor Revelations (8-12) (7 max)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Major Contradictions/Inconsistencies from Unreliable Narr (5-8)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                    <th class="column-header">
                        Minor inconsistencies from Unreliable Narr (10-15)
                        <div class="header-controls">
                            <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                            <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- Act I Scenes -->
                <tr class="act1">
                    <td class="scene-cell" contenteditable="true">
                        Scene 1 (Opening Image) - 5%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <tr class="act1">
                    <td class="scene-cell" contenteditable="true">
                        Scene 2 (Inciting Incident) - 14%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <div class="text-item type-large-clue-subtle">
                            <div class="item-content" contenteditable="true">A clue to establish mystery</div>
                            <div class="item-controls">
                                <select class="item-type-select" onchange="updateItemType(this)">
                                    <option value="large-clue-obvious">Large Clue - Obvious</option>
                                    <option value="large-clue-subtle" selected>Large Clue - Subtle</option>
                                    <option value="major-red-herring">Major Red Herring</option>
                                    <option value="minor-misdirection">Minor Misdirection</option>
                                    <option value="major-revelation">Major Twist/Revelation</option>
                                    <option value="minor-revelation">Minor Revelation</option>
                                    <option value="major-contradiction">Major Contradiction</option>
                                    <option value="minor-inconsistency">Minor Inconsistency</option>
                                </select>
                                <button class="delete-item-btn" onclick="deleteTextItem(this)">×</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <div class="text-item type-minor-inconsistency">
                            <div class="item-content" contenteditable="true">We learn that the narrator has a strange father that he questions but the dad didn't help</div>
                            <div class="item-controls">
                                <select class="item-type-select" onchange="updateItemType(this)">
                                    <option value="large-clue-obvious">Large Clue - Obvious</option>
                                    <option value="large-clue-subtle">Large Clue - Subtle</option>
                                    <option value="major-red-herring">Major Red Herring</option>
                                    <option value="minor-misdirection">Minor Misdirection</option>
                                    <option value="major-revelation">Major Twist/Revelation</option>
                                    <option value="minor-revelation">Minor Revelation</option>
                                    <option value="major-contradiction">Major Contradiction</option>
                                    <option value="minor-inconsistency" selected>Minor Inconsistency</option>
                                </select>
                                <button class="delete-item-btn" onclick="deleteTextItem(this)">×</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <tr class="act1">
                    <td class="scene-cell" contenteditable="true">
                        Scene 3 (Lock-in) - 24%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <div class="text-item type-large-clue-subtle">
                            <div class="item-content" contenteditable="true">2-3 clues to build complexity</div>
                            <div class="item-controls">
                                <select class="item-type-select" onchange="updateItemType(this)">
                                    <option value="large-clue-obvious">Large Clue - Obvious</option>
                                    <option value="large-clue-subtle" selected>Large Clue - Subtle</option>
                                    <option value="major-red-herring">Major Red Herring</option>
                                    <option value="minor-misdirection">Minor Misdirection</option>
                                    <option value="major-revelation">Major Twist/Revelation</option>
                                    <option value="minor-revelation">Minor Revelation</option>
                                    <option value="major-contradiction">Major Contradiction</option>
                                    <option value="minor-inconsistency">Minor Inconsistency</option>
                                </select>
                                <button class="delete-item-btn" onclick="deleteTextItem(this)">×</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <div class="text-item type-major-revelation">
                            <div class="item-content" contenteditable="true">We learn the father doesn't actually have cancer</div>
                            <div class="item-controls">
                                <select class="item-type-select" onchange="updateItemType(this)">
                                    <option value="large-clue-obvious">Large Clue - Obvious</option>
                                    <option value="large-clue-subtle">Large Clue - Subtle</option>
                                    <option value="major-red-herring">Major Red Herring</option>
                                    <option value="minor-misdirection">Minor Misdirection</option>
                                    <option value="major-revelation" selected>Major Twist/Revelation</option>
                                    <option value="minor-revelation">Minor Revelation</option>
                                    <option value="major-contradiction">Major Contradiction</option>
                                    <option value="minor-inconsistency">Minor Inconsistency</option>
                                </select>
                                <button class="delete-item-btn" onclick="deleteTextItem(this)">×</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <!-- Act II Scenes -->
                <tr class="act2">
                    <td class="scene-cell" contenteditable="true">
                        Scene 4 (Opening First Encounters) - 40%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <tr class="act2">
                    <td class="scene-cell" contenteditable="true">
                        Scene 5 (Midpoint Revelation) - 57%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <tr class="act2">
                    <td class="scene-cell" contenteditable="true">
                        Scene 6 (Things Get Worse) - 74%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <!-- Act III Scenes -->
                <tr class="act3">
                    <td class="scene-cell" contenteditable="true">
                        Scene 7 (Final Confrontation) - 85%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <tr class="act3">
                    <td class="scene-cell" contenteditable="true">
                        Scene 8 (Resolution of the Sin) - 93%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <div class="text-item type-large-clue-subtle">
                            <div class="item-content" contenteditable="true">A clue in final pieces</div>
                            <div class="item-controls">
                                <select class="item-type-select" onchange="updateItemType(this)">
                                    <option value="large-clue-obvious">Large Clue - Obvious</option>
                                    <option value="large-clue-subtle" selected>Large Clue - Subtle</option>
                                    <option value="major-red-herring">Major Red Herring</option>
                                    <option value="minor-misdirection">Minor Misdirection</option>
                                    <option value="major-revelation">Major Twist/Revelation</option>
                                    <option value="minor-revelation">Minor Revelation</option>
                                    <option value="major-contradiction">Major Contradiction</option>
                                    <option value="minor-inconsistency">Minor Inconsistency</option>
                                </select>
                                <button class="delete-item-btn" onclick="deleteTextItem(this)">×</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <div class="text-item type-character-backstory">
                            <div class="item-content" contenteditable="true">We learn the daughter decided to believe it okay that her father's past crisis, because she is an the brainwashing her father</div>
                            <div class="item-controls">
                                <select class="item-type-select" onchange="updateItemType(this)">
                                    <option value="character-backstory" selected>Character Backstory Reveal</option>
                                    <option value="relationship-truth">Relationship Truth</option>
                                    <option value="small-mystery">Small Mystery Solution</option>
                                </select>
                                <button class="delete-item-btn" onclick="deleteTextItem(this)">×</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
                <tr class="act3">
                    <td class="scene-cell" contenteditable="true">
                        Scene 9 (New Equilibrium) - 100%
                        <button class="scene-delete-btn" onclick="deleteRow(this)">×</button>
                    </td>
                    <td class="data-cell" data-column="1">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="2">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="3">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="4">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="5">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="6">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="7">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                    <td class="data-cell" data-column="8">
                        <button class="add-item-btn" onclick="addTextItem(this)">+</button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td class="count-cell">Count</td>
                    <td class="count-cell" id="count-1">0</td>
                    <td class="count-cell" id="count-2">0</td>
                    <td class="count-cell" id="count-3">0</td>
                    <td class="count-cell" id="count-4">0</td>
                    <td class="count-cell" id="count-5">0</td>
                    <td class="count-cell" id="count-6">0</td>
                    <td class="count-cell" id="count-7">0</td>
                    <td class="count-cell" id="count-8">0</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>
       // Initialize the table and add necessary event listeners
        document.addEventListener('DOMContentLoaded', function() {
            updateAllCounts();
            addTextItemsToEmptyCells();
        });

        function addTextItemsToEmptyCells() {
            const dataCells = document.querySelectorAll('.data-cell');
            dataCells.forEach(cell => {
                if (!cell.querySelector('.text-item') && !cell.querySelector('.add-item-btn')) {
                    const addBtn = document.createElement('button');
                    addBtn.className = 'add-item-btn';
                    addBtn.textContent = '+';
                    addBtn.onclick = function() { addTextItem(this); };
                    cell.appendChild(addBtn);
                }
            });
        }

        function addTextItem(button) {
            const cell = button.parentNode;
            const columnIndex = parseInt(cell.dataset.column);
            const textItem = document.createElement('div');
            textItem.className = 'text-item';
            
            // Create content div
            const contentDiv = document.createElement('div');
            contentDiv.className = 'item-content';
            contentDiv.contentEditable = true;
            contentDiv.placeholder = 'Enter text...';
            textItem.appendChild(contentDiv);
            
            // Create controls div
            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'item-controls';
            
            // Only add type selector for columns that need it (not clue columns)
            if (columnIndex >= 3) { // Columns 3+ need type selectors
                const typeSelect = document.createElement('select');
                typeSelect.className = 'item-type-select';
                typeSelect.onchange = function() { updateItemType(this); };
                
                let options = [];
                
                // Column-specific options
                switch (columnIndex) {
                    case 3: // Major Red Herrings/Misdirection
                        options = [
                            { value: 'false-suspect', text: 'False Suspect' },
                            { value: 'misleading-motivation', text: 'Misleading Motivation' },
                            { value: 'wrong-interpretation', text: 'Wrong Interpretation of Evidence' }
                        ];
                        break;
                    case 4: // Minor Misdirection
                        options = [
                            { value: 'misleading-dialogue', text: 'Misleading Dialogue' },
                            { value: 'coincidence', text: 'Coincidence that Suggests Wrong Conclusion' },
                            { value: 'character-behavior', text: 'Character Behavior that Implies False Things' }
                        ];
                        break;
                    case 5: // Major Twist/Revelation
                        options = [
                            { value: 'major-revelation', text: 'Major Twist/Revelation' }
                        ];
                        break;
                    case 6: // Minor Revelations/Other Information
                        options = [
                            { value: 'character-backstory', text: 'Character Backstory Reveal' },
                            { value: 'relationship-truth', text: 'Relationship Truth' },
                            { value: 'small-mystery', text: 'Small Mystery Solution' }
                        ];
                        break;
                    case 7: // Major Contradictions/Inconsistencies
                        options = [
                            { value: 'memory-error', text: 'Memory "Error" about Key Events' },
                            { value: 'relationship-lie', text: 'Lie about Relationships/Past' },
                            { value: 'misperception', text: 'Misperception about Current Events' }
                        ];
                        break;
                    case 8: // Minor Inconsistencies
                        options = [
                            { value: 'timeline-error', text: 'Small Timeline Error' },
                            { value: 'emotional-contradiction', text: 'Emotional Contradiction' },
                            { value: 'detail-inconsistency', text: 'Details that Don\'t Add Up' }
                        ];
                        break;
                    default:
                        options = [{ value: 'general', text: 'General' }];
                }
                
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    typeSelect.appendChild(opt);
                });
                
                controlsDiv.appendChild(typeSelect);
            }
            
            // Create delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-item-btn';
            deleteBtn.textContent = '×';
            deleteBtn.onclick = function() { deleteTextItem(this); };
            controlsDiv.appendChild(deleteBtn);
            
            textItem.appendChild(controlsDiv);
            
            // Add event listener for content changes
            contentDiv.addEventListener('input', function() {
                updateColumnCount(cell.dataset.column);
            });
            
            // Insert before the add button
            cell.insertBefore(textItem, button);
            contentDiv.focus();
            
            updateColumnCount(cell.dataset.column);
        }

        function updateItemType(select) {
            const textItem = select.closest('.text-item');
            
            // Remove all type classes
            const typeClasses = [
                'type-false-suspect', 'type-misleading-motivation', 'type-wrong-interpretation',
                'type-misleading-dialogue', 'type-coincidence', 'type-character-behavior',
                'type-major-revelation', 'type-character-backstory', 'type-relationship-truth',
                'type-small-mystery', 'type-memory-error', 'type-relationship-lie',
                'type-misperception', 'type-timeline-error', 'type-emotional-contradiction',
                'type-detail-inconsistency'
            ];
            
            typeClasses.forEach(cls => textItem.classList.remove(cls));
            
            // Add new type class
            textItem.classList.add('type-' + select.value);
        }

        function deleteTextItem(button) {
            const textItem = button.parentNode.parentNode;
            const cell = textItem.parentNode;
            const columnIndex = cell.dataset.column;
            
            textItem.remove();
            updateColumnCount(columnIndex);
        }

        function deleteRow(button) {
            if (!confirm('Are you sure you want to delete this scene?')) return;
            
            const row = button.closest('tr');
            row.remove();
            updateAllCounts();
        }

        function updateColumnCount(columnIndex) {
            if (!columnIndex) return;
            
            let count = 0;
            const cells = document.querySelectorAll(`[data-column="${columnIndex}"]`);
            
            cells.forEach(cell => {
                const textItems = cell.querySelectorAll('.text-item');
                textItems.forEach(item => {
                    const content = item.querySelector('.item-content');
                    if (content && content.textContent.trim() !== '') {
                        count++;
                    }
                });
            });
            
            const countCell = document.getElementById(`count-${columnIndex}`);
            if (countCell) {
                countCell.textContent = count;
            }
        }

        function updateAllCounts() {
            for (let i = 1; i <= 8; i++) {
                updateColumnCount(i);
            }
        }

        function addColumn() {
            const table = document.getElementById('outlineTable');
            const headerRow = table.querySelector('thead tr');
            const bodyRows = table.querySelectorAll('tbody tr');
            const footerRow = table.querySelector('tfoot tr');
            
            const columnIndex = headerRow.children.length;
            
            // Add header
            const newHeader = document.createElement('th');
            newHeader.className = 'column-header';
            newHeader.innerHTML = `
                New Column
                <div class="header-controls">
                    <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                    <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                </div>
            `;
            headerRow.appendChild(newHeader);
            
            // Add cells to body rows
            bodyRows.forEach(row => {
                const newCell = document.createElement('td');
                newCell.className = 'data-cell';
                newCell.dataset.column = columnIndex - 1;
                
                const addBtn = document.createElement('button');
                addBtn.className = 'add-item-btn';
                addBtn.textContent = '+';
                addBtn.onclick = function() { addTextItem(this); };
                newCell.appendChild(addBtn);
                
                row.appendChild(newCell);
            });
            
            // Add footer count cell
            const newCountCell = document.createElement('td');
            newCountCell.className = 'count-cell';
            newCountCell.id = `count-${columnIndex - 1}`;
            newCountCell.textContent = '0';
            footerRow.appendChild(newCountCell);
        }

        function addRow() {
            const table = document.getElementById('outlineTable');
            const tbody = table.querySelector('tbody');
            const headerCount = table.querySelector('thead tr').children.length;
            
            const newRow = document.createElement('tr');
            newRow.className = 'act2'; // Default to Act II styling
            
            // Scene cell
            const sceneCell = document.createElement('td');
            sceneCell.className = 'scene-cell';
            sceneCell.contentEditable = true;
            sceneCell.innerHTML = `New Scene - 0%<button class="scene-delete-btn" onclick="deleteRow(this)">×</button>`;
            newRow.appendChild(sceneCell);
            
            // Data cells
            for (let i = 1; i < headerCount; i++) {
                const dataCell = document.createElement('td');
                dataCell.className = 'data-cell';
                dataCell.dataset.column = i;
                
                const addBtn = document.createElement('button');
                addBtn.className = 'add-item-btn';
                addBtn.textContent = '+';
                addBtn.onclick = function() { addTextItem(this); };
                dataCell.appendChild(addBtn);
                
                newRow.appendChild(dataCell);
            }
            
            tbody.appendChild(newRow);
        }

        function deleteColumn(button) {
            if (!confirm('Are you sure you want to delete this column?')) return;
            
            const header = button.closest('th');
            const columnIndex = Array.from(header.parentNode.children).indexOf(header);
            
            if (columnIndex === 0) {
                alert('Cannot delete the scenes column');
                return;
            }
            
            // Remove header
            header.remove();
            
            // Remove cells from all rows
            const table = document.getElementById('outlineTable');
            const rows = table.querySelectorAll('tbody tr, tfoot tr');
            rows.forEach(row => {
                if (row.children[columnIndex]) {
                    row.children[columnIndex].remove();
                }
            });
            
            // Update column indices
            updateColumnIndices();
        }

        function updateColumnIndices() {
            const table = document.getElementById('outlineTable');
            const bodyRows = table.querySelectorAll('tbody tr');
            
            bodyRows.forEach(row => {
                const dataCells = row.querySelectorAll('.data-cell');
                dataCells.forEach((cell, index) => {
                    cell.dataset.column = index + 1;
                });
            });
            
            // Update count cell IDs
            const countCells = table.querySelectorAll('tfoot .count-cell');
            countCells.forEach((cell, index) => {
                if (index > 0) {
                    cell.id = `count-${index}`;
                }
            });
            
            updateAllCounts();
        }

        function editColumnHeader(button) {
            const header = button.closest('th');
            const currentText = header.firstChild.textContent.trim();
            const newText = prompt('Enter new column header:', currentText);
            
            if (newText !== null && newText.trim() !== '') {
                header.innerHTML = `
                    ${newText}
                    <div class="header-controls">
                        <button class="header-btn" onclick="editColumnHeader(this)">✎</button>
                        <button class="header-btn" onclick="deleteColumn(this)">✗</button>
                    </div>
                `;
            }
        }

        function saveData() {
            const data = {
                title: document.querySelector('.editable-title').value,
                table: document.getElementById('outlineTable').outerHTML
            };
            
            // Save to localStorage (browser storage)
            localStorage.setItem('thrillerOutline', JSON.stringify(data));
            
            // Also create downloadable backup
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            // Auto-download backup file
            const link = document.createElement('a');
            link.href = url;
            link.download = 'thriller-outline-backup-' + new Date().toISOString().slice(0,10) + '.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Progress saved to browser AND downloaded as backup file!');
        }

        function loadData() {
            const saved = localStorage.getItem('thrillerOutline');
            if (saved) {
                const data = JSON.parse(saved);
                document.querySelector('.editable-title').value = data.title;
                document.getElementById('outlineTable').outerHTML = data.table;
                
                // Re-attach event listeners
                setTimeout(() => {
                    updateAllCounts();
                    addTextItemsToEmptyCells();
                }, 100);
                
                alert('Progress loaded from browser storage!');
            } else {
                alert('No saved progress found!');
            }
        }

        function exportData() {
            const data = {
                title: document.querySelector('.editable-title').value,
                table: document.getElementById('outlineTable').outerHTML,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'thriller-outline-export-' + new Date().toISOString().slice(0,10) + '.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.title && data.table) {
                                document.querySelector('.editable-title').value = data.title;
                                document.getElementById('outlineTable').outerHTML = data.table;
                                
                                // Save to localStorage
                                localStorage.setItem('thrillerOutline', JSON.stringify({
                                    title: data.title,
                                    table: data.table
                                }));
                                
                                // Re-attach event listeners
                                setTimeout(() => {
                                    updateAllCounts();
                                    addTextItemsToEmptyCells();
                                }, 100);
                                
                                alert('Data imported successfully!');
                            } else {
                                alert('Invalid file format!');
                            }
                        } catch (error) {
                            alert('Error reading file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        function deleteSelectedRow() {
            alert('Hover over any scene and click the × button that appears to delete it.');
        }
    </script>
</body>
</html>
